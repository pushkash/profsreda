{% extends "base.html" %}
{% load static %}

{% block content %}

    {% if error %}
        <!-- row -->
        <div class="row">

            <div class="col-md-10 col-md-offset-1" style="margin-top: 20px;">
                <div class="text-center">
                    <h2>Результаты теста <br/> {{ questionnaire.name }} не удалось загрузить</h2>
                    <a href="../../../../../tests/views/all_tests/">
                        <button class="main-button">Другие тесты</button>
                    </a>
                </div>
            </div>
        </div>
    {% else %}


    <!-- container -->
    <div class="container">

        <!-- header -->
        <div class="test-header text-center printable-area">
            <h2>{{ test.name }}</h2>
        </div>

        <div class="result-view">
            {% if test_result.is_reliable %}
            <div class='result-header row'>
                <div class='col-md-9'>
                    <h4 class='printable-area'>Ваш результат:</h4>
                </div>
                <div class='col-md-3'>
                    <button class='btn btn-default' id='print-result-btn'>Распечатать результат</button>
                </div>
            </div>
            <div class='result-categories printable-area'>
                {% for category in result_categories %}
                <div class='result-category'>
                    <span class='category-name'>{{category.category.name}}</span>
                    {% if test.show_severity_ratio %}
                        <span class='category-severity-ratio'>Степень выраженности: <span>{{category.severity_ratio_interpretation}}</span></span>
                        <br>
                    {% endif %}
                    <span class='short-description'>{{category.category.short_description|linebreaks}}</span>
                    <div class='long-description'>{{category.category.long_description|linebreaks}}</div>
                </div>
                {% endfor %}
            </div>

            <!-- Loot -->
            <div>
                {% if result_items|length > 0 %}
                    <h4>Ваша награда:</h4>

                    <div class='result-items row'>
                        {% for item in result_items %}
                        <div class='col-md-3'>
                            <div class="item-card">
                                <img class="item-icon media-object img-responsive full-width" src='{{ item.item.icon.url }}'>
                                <div class="item-title">
                                    {{ item.item.name }}
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                {% endif %}
            </div>

            <div class="tests">
                <h4>Другие тесты</h4>
                <div class='row course'>
                    {% for test in tests %}
                        {% include 'partials/test-card.html' %}
                    {% endfor %}
                </div>
            </div>

            {% else %}
                <div class='row lie-result'>
                    <div class='col-md-3'>
                        <img class='lie-img center' src="{% static "img/icon-lie.png" %} "/>
                    </div>
                    <div class='col-md-9'> 
                        <h4> <span class='category-name'>Кажется, некоторые ответы противоречат друг другу.</span></h4>
                        <p>Сейчас невозможно достоверно определить ваши результаты. 
                        Попробуйте пройти тест снова и отвечать честно, не задумываясь.</p>
                        <a href="../../../../../tests/views/test_view/{{test.id}}">
                            <button class="main-button">Пройти тест заново</button>
                        </a>
                    </div>
                </div>
            {% endif %}

            
        </div>
    </div>

    <script>
        makeSameElementsHeight(document.getElementsByClassName('test-details'))
        makeSameElementsHeight(document.getElementsByClassName('item-title'))
        makeSameElementsHeight(document.getElementsByClassName('item-icon'))

        document.getElementById('print-result-btn').addEventListener('click', (e) => {
            window.print();
        })
        
    </script>

    {% endif %}
{% endblock %}